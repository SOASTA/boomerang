<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Boomerang Tutorial: Non-Blocking Loader Snippet</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.akamai.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Boomerang</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BOOMR.html">BOOMR</a></li><li><a href="BOOMR.browser.html">BOOMR.browser</a></li><li><a href="BOOMR.constants.html">BOOMR.constants</a></li><li><a href="BOOMR.plugins.html">BOOMR.plugins</a></li><li><a href="BOOMR.plugins.Angular.html">BOOMR.plugins.Angular</a></li><li><a href="BOOMR.plugins.AutoXHR.html">BOOMR.plugins.AutoXHR</a></li><li><a href="BOOMR.plugins.Backbone.html">BOOMR.plugins.Backbone</a></li><li><a href="BOOMR.plugins.BW.html">BOOMR.plugins.BW</a></li><li><a href="BOOMR.plugins.CACHE_RELOAD.html">BOOMR.plugins.CACHE_RELOAD</a></li><li><a href="BOOMR.plugins.Clicks.html">BOOMR.plugins.Clicks</a></li><li><a href="BOOMR.plugins.Continuity.html">BOOMR.plugins.Continuity</a></li><li><a href="BOOMR.plugins.Continuity.ClickMonitor.html">BOOMR.plugins.Continuity.ClickMonitor</a></li><li><a href="BOOMR.plugins.Continuity.FrameRateMonitor.html">BOOMR.plugins.Continuity.FrameRateMonitor</a></li><li><a href="BOOMR.plugins.Continuity.InteractionMonitor.html">BOOMR.plugins.Continuity.InteractionMonitor</a></li><li><a href="BOOMR.plugins.Continuity.KeyMonitor.html">BOOMR.plugins.Continuity.KeyMonitor</a></li><li><a href="BOOMR.plugins.Continuity.LongTaskMonitor.html">BOOMR.plugins.Continuity.LongTaskMonitor</a></li><li><a href="BOOMR.plugins.Continuity.MouseMonitor.html">BOOMR.plugins.Continuity.MouseMonitor</a></li><li><a href="BOOMR.plugins.Continuity.OrientationMonitor.html">BOOMR.plugins.Continuity.OrientationMonitor</a></li><li><a href="BOOMR.plugins.Continuity.PageBusyMonitor.html">BOOMR.plugins.Continuity.PageBusyMonitor</a></li><li><a href="BOOMR.plugins.Continuity.ScrollMonitor.html">BOOMR.plugins.Continuity.ScrollMonitor</a></li><li><a href="BOOMR.plugins.Continuity.StatsMonitor.html">BOOMR.plugins.Continuity.StatsMonitor</a></li><li><a href="BOOMR.plugins.Continuity.Timeline.html">BOOMR.plugins.Continuity.Timeline</a></li><li><a href="BOOMR.plugins.Continuity.VisibilityMonitor.html">BOOMR.plugins.Continuity.VisibilityMonitor</a></li><li><a href="BOOMR.plugins.CT.html">BOOMR.plugins.CT</a></li><li><a href="BOOMR.plugins.DNS.html">BOOMR.plugins.DNS</a></li><li><a href="BOOMR.plugins.Ember.html">BOOMR.plugins.Ember</a></li><li><a href="BOOMR.plugins.Errors.html">BOOMR.plugins.Errors</a></li><li><a href="BOOMR.plugins.GUID.html">BOOMR.plugins.GUID</a></li><li><a href="BOOMR.plugins.History.html">BOOMR.plugins.History</a></li><li><a href="BOOMR.plugins.IFrameDelay.html">BOOMR.plugins.IFrameDelay</a></li><li><a href="BOOMR.plugins.IPv6.html">BOOMR.plugins.IPv6</a></li><li><a href="BOOMR.plugins.Memory.html">BOOMR.plugins.Memory</a></li><li><a href="BOOMR.plugins.Mobile.html">BOOMR.plugins.Mobile</a></li><li><a href="BOOMR.plugins.NavigationTiming.html">BOOMR.plugins.NavigationTiming</a></li><li><a href="BOOMR.plugins.PaintTiming.html">BOOMR.plugins.PaintTiming</a></li><li><a href="BOOMR.plugins.ResourceTiming.html">BOOMR.plugins.ResourceTiming</a></li><li><a href="BOOMR.plugins.RT.html">BOOMR.plugins.RT</a></li><li><a href="BOOMR.plugins.SPA.html">BOOMR.plugins.SPA</a></li><li><a href="BOOMR.plugins.TPAnalytics.html">BOOMR.plugins.TPAnalytics</a></li><li><a href="BOOMR.plugins.UserTiming.html">BOOMR.plugins.UserTiming</a></li><li><a href="BOOMR.utils.html">BOOMR.utils</a></li><li><a href="BOOMR.utils.Compression.html">BOOMR.utils.Compression</a></li><li><a href="BOOMR.utils.MD5.html">BOOMR.utils.MD5</a></li><li><a href="BOOMR_mq.html">BOOMR_mq</a></li><li><a href="MutationHandler.html">MutationHandler</a></li><li><a href="ProxyXHRImplementation.html">ProxyXHRImplementation</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BOOMR.html#event:beacon">BOOMR#event:beacon</a></li><li><a href="BOOMR.html#event:before_beacon">BOOMR#event:before_beacon</a></li><li><a href="BOOMR.html#event:before_unload">BOOMR#event:before_unload</a></li><li><a href="BOOMR.html#event:click">BOOMR#event:click</a></li><li><a href="BOOMR.html#event:config">BOOMR#event:config</a></li><li><a href="BOOMR.html#event:dom_loaded">BOOMR#event:dom_loaded</a></li><li><a href="BOOMR.html#event:error">BOOMR#event:error</a></li><li><a href="BOOMR.html#event:form_submit">BOOMR#event:form_submit</a></li><li><a href="BOOMR.html#event:netinfo">BOOMR#event:netinfo</a></li><li><a href="BOOMR.html#event:page_load_beacon">BOOMR#event:page_load_beacon</a></li><li><a href="BOOMR.html#event:page_ready">BOOMR#event:page_ready</a></li><li><a href="BOOMR.html#event:page_unload">BOOMR#event:page_unload</a></li><li><a href="BOOMR.html#event:prerender_to_visible">BOOMR#event:prerender_to_visible</a></li><li><a href="BOOMR.html#event:rage_click">BOOMR#event:rage_click</a></li><li><a href="BOOMR.html#event:spa_init">BOOMR#event:spa_init</a></li><li><a href="BOOMR.html#event:spa_navigation">BOOMR#event:spa_navigation</a></li><li><a href="BOOMR.html#event:visibility_changed">BOOMR#event:visibility_changed</a></li><li><a href="BOOMR.html#event:xhr_error">BOOMR#event:xhr_error</a></li><li><a href="BOOMR.html#event:xhr_init">BOOMR#event:xhr_init</a></li><li><a href="BOOMR.html#event:xhr_load">BOOMR#event:xhr_load</a></li><li><a href="BOOMR.html#event:xhr_send">BOOMR#event:xhr_send</a></li><li><a href="document.html#event:onBeforeBoomerangBeacon">document#event:onBeforeBoomerangBeacon</a></li><li><a href="document.html#event:onBoomerangBeacon">document#event:onBoomerangBeacon</a></li><li><a href="document.html#event:onBoomerangLoaded">document#event:onBoomerangLoaded</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-building.html">Building</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-creating-plugins.html">Creating Plugins</a></li><li><a href="tutorial-howtos.html">How-Tos</a></li><li><a href="tutorial-loader-snippet.html">Non-Blocking Loader Snippet</a></li><li><a href="tutorial-methodology.html">Methodology</a></li><li><a href="tutorial-tests.html">Tests</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#BOOMR_check_doc_domain">BOOMR_check_doc_domain</a></li><li><a href="global.html#BOOMR_lstart">BOOMR_lstart</a></li><li><a href="global.html#BOOMR_onload">BOOMR_onload</a></li><li><a href="global.html#BOOMR_start">BOOMR_start</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    <h1>Non-Blocking Loader Snippet</h1>
</header>

<article>
    <p>If you are loading boomerang.js separately from your main application bundle, i.e.
from a CDN or a third-party service (such as mPulse), we recommend loading boomerang.js
using the non-blocking script loader pattern.</p>
<p>The methodology, <a href="http://www.lognormal.com/blog/2012/12/12/the-script-loader-pattern/">developed by Philip Tellis</a>
and others, ensures Boomerang (or any third-party JavaScript) loads asynchronously
and non-blocking.  This means that the browser will not pause while the JavaScript
is loading, nor will it block the <code>onload</code> event.</p>
<p>The Boomerang Loader Snippet is currently around 50 lines of code.  The snippet
does the following:</p>
<ol>
<li>It checks whether or not the snippet has already been run or Boomerang has already
 been loaded.  If so, it exits.</li>
<li>It adds a <code>window</code> <code>load</code> event handler, to ensure that Boomerang can measure
 the Page Load time in non-NavigationTiming browsers, even if boomerang.js
 loads after the <code>load</code> event.</li>
<li>Next, a hidden <code>&lt;iframe&gt;</code> is injected into the page</li>
<li>The snippet attempts to read the IFRAME's <code>contentWindow.document</code>.  If it can't,
 it updates the IFRAME's <code>src</code> to add JavaScript that sets the IFRAME's <code>document.domain</code>
 to the current page's <code>document.domain</code>.  This ensures the anonymous IFRAME
 can communicate with the host page.</li>
<li>It writes a function <code>_l()</code> to the IFRAME's <code>document</code> which will add a
 <code>&lt;script&gt;</code> tag that loads boomerang.js</li>
<li>It sets the IFRAME's <code>&lt;body onload=&quot;document._l()&quot;&gt;</code> to run the function
 above, so the <code>&lt;script&gt;</code> tag is loaded after the IFRAME's <code>onload</code> event has fired.</li>
</ol>
<p>Note: We split the <code>&lt;body</code> tag insertion into <code>&lt;bo</code> and <code>dy</code> to avoid server-side output filters that may replace <code>&lt;body</code> tags with their own code.</p>
<p>For proof that the non-blocking script loader pattern does not affect page load,
you can look at this
<a href="http://dev.nicj.net/boomerang-audit/test-mpulse-loader-snippet-delayed.html">test case</a>
that delays JavaScript from loading by 5 seconds or these
<a href="https://www.webpagetest.org/result/171221_HD_bb090190517fa8dd101859e8c1f327fe/">WebPagetest results</a>.</p>
<h2>The Snippet</h2><p>Here's the snippet:</p>
<pre class="prettyprint source lang-html"><code>&lt;script>
(function(){
  // Boomerang Loader Snippet version 10
  if (window.BOOMR && (window.BOOMR.version || window.BOOMR.snippetExecuted)) {
    return;
  }

  window.BOOMR = window.BOOMR || {};
  window.BOOMR.snippetExecuted = true;

  var dom, doc, where, iframe = document.createElement(&quot;iframe&quot;), win = window;

  function boomerangSaveLoadTime(e) {
    win.BOOMR_onload = (e && e.timeStamp) || new Date().getTime();
  }

  if (win.addEventListener) {
    win.addEventListener(&quot;load&quot;, boomerangSaveLoadTime, false);
  } else if (win.attachEvent) {
    win.attachEvent(&quot;onload&quot;, boomerangSaveLoadTime);
  }

  iframe.src = &quot;javascript:void(0)&quot;;
  iframe.title = &quot;&quot;;
  iframe.role = &quot;presentation&quot;;
  (iframe.frameElement || iframe).style.cssText = &quot;width:0;height:0;border:0;display:none;&quot;;
  where = document.getElementsByTagName(&quot;script&quot;)[0];
  where.parentNode.insertBefore(iframe, where);

  try {
    doc = iframe.contentWindow.document;
  } catch (e) {
    dom = document.domain;
    iframe.src = &quot;javascript:var d=document.open();d.domain='&quot; + dom + &quot;';void(0);&quot;;
    doc = iframe.contentWindow.document;
  }

  doc.open()._l = function() {
    var js = this.createElement(&quot;script&quot;);
    if (dom) {
      this.domain = dom;
    }
    js.id = &quot;boomr-if-as&quot;;
    js.src = &quot;http://your-cdn.host.com/path/to/boomerang-&lt;version>.js&quot;;
    BOOMR_lstart = new Date().getTime();
    this.body.appendChild(js);
  };
  doc.write('&lt;bo' + 'dy onload=&quot;document._l();&quot;>');
  doc.close();
})();
&lt;/script></code></pre><h2>Delaying the Snippet</h2><p>You may want to delay loading Boomerang until after the <code>onload</code> event.  This would
ensure that no Boomerang code is executed in the critical-path of the page load.</p>
<p>The main downside to doing this is that you are more likely to lose beacons
from some users.  The longer it takes Boomerang to load on the page, the higher
chance that the user will have navigated away, or closed the browser, before
boomerang.js is loaded.</p>
<p>Here is a modification of the Boomerang Loader Snippet to delay until after
<code>onload</code>:</p>
<pre class="prettyprint source lang-html"><code>&lt;script>
(function(){
  // Boomerang Delayed Loader Snippet version 10
  if (window.BOOMR && (window.BOOMR.version || window.BOOMR.snippetExecuted)) {
    return;
  }

  window.BOOMR = window.BOOMR || {};
  window.BOOMR.snippetExecuted = true;

  var win = window;

  function boomerangSaveLoadTime(e) {
    win.BOOMR_onload = (e && e.timeStamp) || new Date().getTime();
  }

  function boomerangLoad() {
    var dom, doc, where, iframe = document.createElement(&quot;iframe&quot;), win = window;
    iframe.src = &quot;javascript:void(0)&quot;;
    iframe.title = &quot;&quot;;
    iframe.role = &quot;presentation&quot;;
    (iframe.frameElement || iframe).style.cssText = &quot;width:0;height:0;border:0;display:none;&quot;;
    where = document.getElementsByTagName(&quot;script&quot;)[0];
    where.parentNode.insertBefore(iframe, where);

    try {
      doc = iframe.contentWindow.document;
    } catch(e) {
      dom = document.domain;
      iframe.src = &quot;javascript:var d=document.open();d.domain='&quot; + dom + &quot;';void(0);&quot;;
      doc = iframe.contentWindow.document;
    }

    doc.open()._l = function() {
      var js = this.createElement(&quot;script&quot;);
      if (dom) {
        this.domain = dom;
      }
      js.id = &quot;boomr-if-as&quot;;
      js.src = &quot;http://your-cdn.host.com/path/to/boomerang-&lt;version>.js&quot;;
      BOOMR_lstart = new Date().getTime();
      this.body.appendChild(js);
    };
    doc.write('&lt;bo' + 'dy onload=&quot;document._l();&quot;>');
    doc.close();
  }

  function windowOnLoad(e) {
    boomerangSaveLoadTime(e);
    setTimeout(boomerangLoad, 0);
  }

  if ((&quot;performance&quot; in win && win.performance && win.performance.timing && win.performance.timing.loadEventStart)
      || (document.readyState === &quot;complete&quot;)) {
    boomerangLoad();
  } else {
    if (win.addEventListener) {
      win.addEventListener(&quot;load&quot;, windowOnLoad, false);
    } else if (win.attachEvent) {
      win.attachEvent(&quot;onload&quot;, windowOnLoad);
    }
  }
})();
&lt;/script></code></pre>
</article>



</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	© 2010-2017 the contributors to the Open Source Boomerang project and Akamai Technologies, Inc.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on Mon Oct 15th 2018
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>